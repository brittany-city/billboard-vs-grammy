---
title: "Billboard versus Grammy "
author: "Brittany"
date: "1/4/2020"
output: html_document 
---    

DATA IMPORT AND CLEANING

```{r}
library(tidyverse)
library(lubridate)
library(timeDate)
library(ggplot2)
library(reshape2)
```


Read in grammy and billboard dataset - Grammys range from 1959-2019, Billboard range from August 1958 to June 2019. 
```{r}
grammy <- read_csv("~/Documents/nss_data_science/billboard-vs-grammy/data/grammy_wins.csv")
billboard <- read_csv("~/Documents/nss_data_science/billboard-vs-grammy/data/billboard.csv")
```
Keep only Grammy General Fields (Big Four)
```{r}
grammy = filter(grammy, (category %in% c("Record Of The Year", "Album Of The Year","Song Of The Year","Best New Artist")))  %>%
  select(-c('awardType'))
```

```{r}
grammy[grammy$Performer == "Bette Midler", "Ethnicity"] <- "White"                   
```

Add "year" column in Grammy dataset
```{r}
grammy$year <- 1958 + grammy$annualGrammy
```

Add "award_date" column in Grammy dataset
```{r}
grammy$award_date <- lubridate::ymd(grammy$year, truncated = 2L)
```

Add "cutoff_date" column in Grammy dataset
```{r}
grammy$award_date <- as.Date(grammy$award_date, "%m/%d/%Y")
grammy$cutoff_date <- as.Date(grammy$award_date) %m-% months(4)
```

Remove columns from Billboard
```{r}
billboard <- billboard %>% 
  select(-c('url','SongID','Previous Week Position', 'Peak Position','Weeks on Chart'))
```

Convert Billboard "WeekID" column to date
```{r}
billboard$WeekID <- as.Date(billboard$WeekID , "%m/%d/%Y")
```

To fix NA values in the merged dataset, edit the Performer name to match in merge
```{r}
billboard <- billboard %>%
  mutate(Performer = str_replace(Performer, "Macklemore & Ryan Lewis Featuring Eric Nally, Melle Mel, Kool Moe Dee & Grandmaster Caz","Macklemore & Ryan Lewis")) %>% 
  mutate(Performer = str_replace(Performer, "Macklemore & Ryan Lewis Featuring Mary Lambert","Macklemore & Ryan Lewis")) %>%
  mutate(Performer = str_replace(Performer, "Macklemore & Ryan Lewis Featuring Ray Dalton", "Macklemore & Ryan Lewis")) %>%
  mutate(Performer = str_replace(Performer, "Macklemore & Ryan Lewis Featuring ScHoolboy Q & Hollis", "Macklemore & Ryan Lewis")) %>%
  mutate(Performer = str_replace(Performer, "Macklemore & Ryan Lewis Featuring Wanz", "Macklemore & Ryan Lewis"))
```

Merge Grammy Artist with Billboard datasets
```{r}
grammy_artist <- filter(grammy, (category %in% ("Best New Artist")))
grammy_artist <- merge(x=grammy_artist, y=billboard, by=c("Performer"), all.x=TRUE) %>%
  select(-c('Song.x')) %>%
  rename(Song = 'Song.y')
```

Merge Grammy Album and Song with Billboard datasets
```{r}
grammy_album_song <- filter(grammy, (category %in% c("Album Of The Year","Record Of The Year","Song Of The Year")))
grammy_album_song <- merge(x=grammy_album_song,y=billboard,by=c("Performer","Song"), all.x=TRUE)
```

Stack grammy_artist and grammy_album_song to create one dataset
```{r}
grammy_billboard <- rbind(grammy_artist, grammy_album_song)
```

PLOTS FOR R SHINY APP

Test filter
```{r}
grammy_filter <- grammy_billboard %>%
            filter(year == 2019)
```


Time series example
```{r}
filter <- grammy_billboard %>%
  filter(year == 2019) %>%
  filter(category == "Record Of The Year")
```

```{r}
ggplot(filteredSong, aes(x = filteredSong$WeekID, y = filteredSong$'Week Position')) + geom_point(aes(color = filteredSong$Song)) + geom_vline(aes(xintercept=(filteredSong$award_date[1])),linetype=8, colour="black") + geom_vline(aes(xintercept=(filteredSong$cutoff_date[1])),linetype=5, colour="red") + xlab("WeekID") + ylab("Week Position") + scale_color_discrete(name = "Song") + scale_y_reverse() + scale_x_date(breaks=pretty(as.Date(filteredSong$WeekID, "%m-%Y")))
```


```{r}
filteredAlbum <- grammy_billboard %>%
  filter(year == 1978) %>%
  filter(category == "Album Of The Year")
```

```{r}
ggplot(filteredAlbum, aes(x = filteredAlbum$WeekID, y = filteredAlbum$'Week Position')) + geom_point(aes(color = filteredAlbum$Song)) + geom_vline(aes(xintercept=(filteredAlbum$award_date[1])),linetype=8, colour="black") + geom_vline(aes(xintercept=(filteredAlbum$cutoff_date[1])),linetype=5, colour="red") + xlab("WeekID") + ylab("Week Position") + scale_color_discrete(name = "Song") + scale_y_reverse() + scale_x_date(breaks=pretty(as.Date(filteredAlbum$WeekID, "%m-%Y")))
```


ANALYSIS
```{r}

grammy_Ethnic <- 
  grammy %>%
   group_by(Ethnicity,Performer) %>%
   count(category, sort = TRUE)
  

ggplot(as.data.frame(grammy_Ethnic), aes(factor(Ethnicity), n, fill = category)) +     
  geom_col() + xlab("Performer Ethnicity") + ylab("Grammy Awards") + scale_fill_discrete(name = "Award Category")
  #ggplot(grammy, aes(fill=category, x=Ethnicity, y=Song)) + 
    #geom_bar(position="stack", stat="identity")
  #summarize(counts=n()) %>%
  #arrange(-counts)
  
 # mutate(WeekID = fct_reorder(WeekID, n, .desc = TRUE)) %>%
  #ggplot(aes(x=grammy_billboard$Ethnicity, y=n, fill=grammy_billboard$category)) + geom_bar(stat="identity")
```
